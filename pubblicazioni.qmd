---
title: "Publications and Network"
format: html
---

```{r}
#| echo: false
#| message: false
#| warning: false

library(tidyverse)
library(visNetwork)
library(knitr)

pubs <- read.csv("pubblicazioni_db.csv", stringsAsFactors = FALSE)

edges_list <- list()
for(i in 1:nrow(pubs)) {
  authors_vec <- unlist(strsplit(pubs$authors[i], ",\\s*"))
  if(length(authors_vec) > 1) {
    comb <- combn(authors_vec, 2, simplify = FALSE)
    for(c in comb) {
      edges_list[[length(edges_list) + 1]] <- data.frame(from = c[1], to = c[2])
    }
  }
}

edges <- bind_rows(edges_list) %>%
  group_by(from, to) %>%
  summarise(width = n()*1.5, .groups = 'drop')

nodes <- data.frame(id = unique(c(edges$from, edges$to))) %>%
  mutate(
    label = id,
    shape = "dot",
    color = ifelse(id == "Anastasi S.", "#FFD1DC", "#DEF3F6"), 
    size = ifelse(id == "Anastasi S.", 35, 20)
  )

visNetwork(nodes, edges) %>%
  visOptions(highlightNearest = TRUE, nodesIdSelection = TRUE) %>%
  visPhysics(solver = "forceAtlas2Based", 
             forceAtlas2Based = list(gravitationalConstant = -80)) %>%
  visLayout(randomSeed = 123) %>%
  visEvents(type = "once", startStabilizing = "function() {this.moveTo({scale:0.8})}")
```
```{r}
#| echo: false
#| results: asis
pubs %>%
  arrange(desc(year)) %>%
  mutate(APA = paste0(authors, " (", year, "). ", title, ". [", type, "].")) %>%
  select(APA) %>%
  kable(col.names = NULL, format = "markdown")
```